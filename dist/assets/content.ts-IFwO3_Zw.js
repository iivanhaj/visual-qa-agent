import{S as r,I as n,A as b,T as l}from"./aiSuggestionService-B5Hx7-2E.js";import"./index-DU3xAm2I.js";class w{constructor(t){this.document=t}analyze(){const t=[];return t.push(...this.checkMetaTags()),t.push(...this.checkHeadingHierarchy()),t.push(...this.checkImageAltText()),t.push(...this.checkOpenGraphTags()),t}checkMetaTags(){var o;const t=[],i=this.document.querySelector("title");return!i||!((o=i.textContent)!=null&&o.trim())?t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.Critical,title:"Missing or Empty Title Tag",description:"The page is missing a title tag or it is empty. This is critical for SEO and browser tabs.",location:"<head>",suggestion:"Add a descriptive title tag (50-60 characters) that accurately describes the page content.",codeSnippet:{before:`<head>
  <!-- No title tag -->`,after:`<head>
  <title>Your Page Title - Brand Name</title>`},resources:["https://moz.com/learn/seo/title-tag"]}):i.textContent.length>60&&t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.Medium,title:"Title Tag Too Long",description:`Title tag has ${i.textContent.length} characters. Google typically displays first 50-60 characters.`,location:"<head> > title",element:i.outerHTML,suggestion:"Shorten the title tag to 50-60 characters for better display in search results.",resources:["https://moz.com/learn/seo/title-tag"]}),this.document.querySelector('meta[name="description"]')||t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.High,title:"Missing Meta Description",description:"No meta description found. This affects how your page appears in search results.",location:"<head>",suggestion:"Add a meta description tag (150-160 characters) that summarizes the page content.",codeSnippet:{before:`<head>
  <title>Page Title</title>`,after:`<head>
  <title>Page Title</title>
  <meta name="description" content="A compelling description of your page content.">`},resources:["https://moz.com/learn/seo/meta-description"]}),this.document.querySelector('meta[name="viewport"]')||t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.High,title:"Missing Viewport Meta Tag",description:"No viewport meta tag found. This is essential for mobile responsiveness.",location:"<head>",suggestion:"Add a viewport meta tag for proper mobile display.",codeSnippet:{before:"<head>",after:`<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">`},resources:["https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag"]}),t}checkHeadingHierarchy(){const t=[],i=this.document.querySelectorAll("h1");i.length===0?t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.High,title:"Missing H1 Heading",description:"No H1 heading found on the page. Every page should have exactly one H1.",location:"body",suggestion:"Add a single H1 heading that describes the main topic of the page.",codeSnippet:{before:`<body>
  <h2>Some content</h2>`,after:`<body>
  <h1>Main Page Heading</h1>
  <h2>Some content</h2>`},resources:["https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements"]}):i.length>1&&t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.Medium,title:"Multiple H1 Headings",description:`Found ${i.length} H1 headings. Best practice is to have exactly one H1 per page.`,location:"body",suggestion:"Use only one H1 for the main page heading, and use H2-H6 for subheadings.",resources:["https://www.w3.org/WAI/tutorials/page-structure/headings/"]});const e=Array.from(this.document.querySelectorAll("h1, h2, h3, h4, h5, h6"));for(let s=1;s<e.length;s++){const o=parseInt(e[s].tagName[1]),a=parseInt(e[s-1].tagName[1]);o-a>1&&t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.Low,title:"Heading Hierarchy Skipped",description:`Heading skips from H${a} to H${o}. Should increment by one level at a time.`,location:this.getElementPath(e[s]),element:e[s].outerHTML,suggestion:"Maintain a logical heading hierarchy without skipping levels.",resources:["https://www.w3.org/WAI/tutorials/page-structure/headings/"]})}return t}checkImageAltText(){const t=[];return this.document.querySelectorAll("img").forEach((e,s)=>{if(!e.hasAttribute("alt"))t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.Medium,title:"Image Missing Alt Attribute",description:"Image does not have an alt attribute. This hurts SEO and accessibility.",location:this.getElementPath(e),element:e.outerHTML,suggestion:'Add descriptive alt text to all images. Use alt="" for decorative images.',codeSnippet:{before:`<img src="${e.src}">`,after:`<img src="${e.src}" alt="Description of the image">`},resources:["https://moz.com/learn/seo/alt-text"]});else if(e.alt.trim()===""&&!e.hasAttribute("role")){const o=e.src||"unknown";!o.includes("icon")&&!o.includes("decoration")&&!o.includes("spacer")&&t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.Low,title:"Image Has Empty Alt Text",description:"Image has empty alt text. Verify if this is truly decorative.",location:this.getElementPath(e),element:e.outerHTML,suggestion:'If the image is decorative, consider adding role="presentation". Otherwise, add descriptive alt text.',resources:["https://www.w3.org/WAI/tutorials/images/decorative/"]})}}),t}checkOpenGraphTags(){const t=[],i=["og:title","og:description","og:image","og:url"],e=[];return i.forEach(s=>{this.document.querySelector(`meta[property="${s}"]`)||e.push(s)}),e.length>0&&t.push({id:crypto.randomUUID(),type:n.SEO,severity:r.Low,title:"Missing Open Graph Tags",description:`Missing ${e.join(", ")}. Open Graph tags improve social media sharing.`,location:"<head>",suggestion:"Add Open Graph meta tags for better social media preview when sharing.",codeSnippet:{before:"<head>",after:`<head>
  <meta property="og:title" content="Your Page Title">
  <meta property="og:description" content="Page description">
  <meta property="og:image" content="https://example.com/image.jpg">
  <meta property="og:url" content="https://example.com/page">`},resources:["https://ogp.me/"]}),t}getElementPath(t){const i=[];let e=t;for(;e&&e!==this.document.documentElement;){let s=e.tagName.toLowerCase();if(e.id){s+=`#${e.id}`,i.unshift(s);break}else if(e.className){const o=Array.from(e.classList).slice(0,2).join(".");o&&(s+=`.${o}`)}i.unshift(s),e=e.parentElement}return i.join(" > ")}}class v{constructor(t){this.document=t}analyze(){const t=[];return t.push(...this.checkImagesAccessibility()),t.push(...this.checkFormAccessibility()),t.push(...this.checkARIA()),t.push(...this.checkKeyboardNavigation()),t.push(...this.checkSemanticHTML()),t}checkImagesAccessibility(){const t=[];return this.document.querySelectorAll("img").forEach(e=>{e.hasAttribute("alt")||t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.High,title:"Image Missing Alt Attribute",description:"Image lacks alt text, making it inaccessible to screen readers.",location:this.getElementPath(e),element:e.outerHTML,suggestion:'Add alt attribute with descriptive text. Use alt="" for decorative images.',codeSnippet:{before:`<img src="${e.src}">`,after:`<img src="${e.src}" alt="Description of the image">`},resources:["https://www.w3.org/WAI/tutorials/images/","https://www.w3.org/WAI/WCAG21/Understanding/non-text-content.html"]})}),t}checkFormAccessibility(){const t=[];return this.document.querySelectorAll('input:not([type="hidden"]), textarea, select').forEach(s=>{const o=this.hasAssociatedLabel(s),a=s.hasAttribute("aria-label")||s.hasAttribute("aria-labelledby");!o&&!a&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.High,title:"Form Input Missing Label",description:"Form field has no associated label, making it difficult for screen reader users.",location:this.getElementPath(s),element:s.outerHTML,suggestion:"Add a <label> element or aria-label attribute to describe the input field.",codeSnippet:{before:'<input type="text" name="email">',after:`<label for="email">Email Address:</label>
<input type="text" id="email" name="email">`},resources:["https://www.w3.org/WAI/tutorials/forms/labels/"]})}),this.document.querySelectorAll("form").forEach(s=>{s.querySelector('button[type="submit"], input[type="submit"]')||t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.Medium,title:"Form Missing Submit Button",description:"Form has no explicit submit button, which can confuse users.",location:this.getElementPath(s),suggestion:"Add a submit button to the form.",codeSnippet:{before:"<form>...</form>",after:`<form>
  ...
  <button type="submit">Submit</button>
</form>`},resources:["https://www.w3.org/WAI/tutorials/forms/"]})}),t}checkARIA(){const t=[],i=this.document.querySelectorAll("[role]"),e=["alert","alertdialog","application","article","banner","button","cell","checkbox","columnheader","combobox","complementary","contentinfo","definition","dialog","directory","document","feed","figure","form","grid","gridcell","group","heading","img","link","list","listbox","listitem","log","main","marquee","math","menu","menubar","menuitem","menuitemcheckbox","menuitemradio","navigation","none","note","option","presentation","progressbar","radio","radiogroup","region","row","rowgroup","rowheader","scrollbar","search","searchbox","separator","slider","spinbutton","status","switch","tab","table","tablist","tabpanel","term","textbox","timer","toolbar","tooltip","tree","treegrid","treeitem"];return i.forEach(o=>{const a=o.getAttribute("role");a&&!e.includes(a)&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.Medium,title:"Invalid ARIA Role",description:`Element has invalid ARIA role: "${a}"`,location:this.getElementPath(o),element:o.outerHTML,suggestion:"Use a valid ARIA role from the WAI-ARIA specification.",resources:["https://www.w3.org/TR/wai-aria-1.2/#role_definitions"]})}),this.document.querySelectorAll("button").forEach(o=>{var h;const a=(h=o.textContent)==null?void 0:h.trim(),u=o.hasAttribute("aria-label")||o.hasAttribute("aria-labelledby");!a&&!u&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.High,title:"Button Missing Accessible Name",description:"Button has no text content or aria-label.",location:this.getElementPath(o),element:o.outerHTML,suggestion:"Add text content to the button or use aria-label to provide an accessible name.",codeSnippet:{before:'<button><i class="icon"></i></button>',after:'<button aria-label="Close">  <i class="icon"></i></button>'},resources:["https://www.w3.org/WAI/WCAG21/Understanding/name-role-value.html"]})}),t}checkKeyboardNavigation(){const t=[];return this.document.querySelectorAll('a, button, input, select, textarea, [onclick], [role="button"]').forEach(s=>{s.getAttribute("tabindex")==="-1"&&!s.hasAttribute("disabled")&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.Medium,title:"Interactive Element Not Keyboard Accessible",description:'Element has tabindex="-1", removing it from keyboard navigation.',location:this.getElementPath(s),element:s.outerHTML,suggestion:'Remove tabindex="-1" or use tabindex="0" to make it keyboard accessible.',resources:["https://www.w3.org/WAI/WCAG21/Understanding/keyboard.html"]})}),this.document.querySelectorAll('[tabindex]:not([tabindex="0"]):not([tabindex="-1"])').forEach(s=>{const o=s.getAttribute("tabindex");o&&parseInt(o)>0&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.Low,title:"Positive Tabindex Value",description:"Element uses positive tabindex, which can create confusing tab order.",location:this.getElementPath(s),element:s.outerHTML,suggestion:'Avoid positive tabindex values. Use tabindex="0" and logical DOM order instead.',resources:["https://www.a11yproject.com/posts/how-to-use-the-tabindex-attribute/"]})}),t}checkSemanticHTML(){const t=[],i=this.document.querySelector("main");this.document.querySelector("nav"),this.document.querySelector("header"),i||t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.Medium,title:"Missing <main> Landmark",description:"Page lacks a <main> element to identify the main content area.",location:"body",suggestion:"Wrap the main content area in a <main> element.",codeSnippet:{before:`<body>
  <div id="content">...</div>
</body>`,after:`<body>
  <main>
    <div id="content">...</div>
  </main>
</body>`},resources:["https://www.w3.org/WAI/tutorials/page-structure/regions/"]});const e=this.document.querySelectorAll("div[onclick], span[onclick]");return e.length>0&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.High,title:"Non-Semantic Clickable Elements",description:`Found ${e.length} div/span elements with onclick handlers. These should be buttons.`,location:"body",suggestion:"Use <button> elements for clickable items instead of div/span with onclick.",codeSnippet:{before:'<div onclick="handleClick()">Click me</div>',after:'<button type="button" onclick="handleClick()">Click me</button>'},resources:["https://www.w3.org/WAI/WCAG21/Understanding/name-role-value.html"]}),t}hasAssociatedLabel(t){const i=t.getAttribute("id");if(i&&this.document.querySelector(`label[for="${i}"]`))return!0;let e=t.parentElement;for(;e;){if(e.tagName==="LABEL")return!0;e=e.parentElement}return!1}getElementPath(t){const i=[];let e=t;for(;e&&e!==this.document.documentElement;){let s=e.tagName.toLowerCase();if(e.id){s+=`#${e.id}`,i.unshift(s);break}else if(e.className){const o=Array.from(e.classList).slice(0,2).join(".");o&&(s+=`.${o}`)}i.unshift(s),e=e.parentElement}return i.join(" > ")}}class A{constructor(t){this.document=t}analyze(){const t=[];return t.push(...this.checkDOMComplexity()),t.push(...this.checkImages()),t.push(...this.checkRenderBlockingResources()),t.push(...this.checkExcessiveScripts()),t}checkDOMComplexity(){const t=[],e=this.document.querySelectorAll("*").length;e>1500&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:e>3e3?r.High:r.Medium,title:"Excessive DOM Size",description:`Page has ${e} DOM nodes. Recommended maximum is 1500 nodes.`,location:"document",suggestion:"Reduce DOM complexity by removing unnecessary elements, using virtual scrolling for long lists, or lazy loading content.",resources:["https://web.dev/dom-size/","https://developer.chrome.com/docs/lighthouse/performance/dom-size/"]});const s=this.getMaxDOMDepth();return s>32&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.Medium,title:"Deep DOM Nesting",description:`Maximum DOM depth is ${s}. Recommended maximum is 32 levels.`,location:"document",suggestion:"Flatten DOM structure to improve rendering performance.",resources:["https://web.dev/dom-size/"]}),t}checkImages(){const t=[],i=this.document.querySelectorAll("img");let e=0,s=0;return i.forEach(o=>{(!o.hasAttribute("width")||!o.hasAttribute("height"))&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.Low,title:"Image Missing Dimensions",description:"Image lacks width/height attributes, which can cause layout shifts.",location:this.getElementPath(o),element:o.outerHTML,suggestion:"Add explicit width and height attributes to prevent Cumulative Layout Shift (CLS).",codeSnippet:{before:`<img src="${o.src}" alt="...">`,after:`<img src="${o.src}" alt="..." width="800" height="600">`},resources:["https://web.dev/cls/"]}),!(o.getBoundingClientRect().top<window.innerHeight)&&!o.hasAttribute("loading")&&s++,o.width*o.height>1e6&&e++}),s>0&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.Medium,title:"Images Not Using Lazy Loading",description:`${s} below-the-fold images are not using lazy loading.`,location:"body",suggestion:'Add loading="lazy" attribute to images that appear below the fold.',codeSnippet:{before:'<img src="image.jpg" alt="...">',after:'<img src="image.jpg" alt="..." loading="lazy">'},resources:["https://web.dev/lazy-loading/"]}),e>3&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.High,title:"Multiple Large Images Detected",description:`Found ${e} large images that may impact page load performance.`,location:"body",suggestion:"Optimize images by compressing them, using modern formats (WebP, AVIF), and implementing responsive images with srcset.",resources:["https://web.dev/optimize-cls/","https://web.dev/use-srcset-to-automatically-choose-the-right-image/"]}),t}checkRenderBlockingResources(){const t=[],i=this.document.querySelectorAll('link[rel="stylesheet"]'),e=[];i.forEach(o=>{const a=o.getAttribute("media");(!a||a==="all"||a==="screen")&&e.push(o)}),e.length>2&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.Medium,title:"Multiple Render-Blocking Stylesheets",description:`Found ${e.length} render-blocking CSS files.`,location:"<head>",suggestion:"Consider inlining critical CSS, combining stylesheets, or using media queries to make some non-blocking.",resources:["https://web.dev/extract-critical-css/","https://web.dev/defer-non-critical-css/"]});const s=this.document.querySelectorAll('head script:not([async]):not([defer]):not([type="module"])');return s.length>0&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.High,title:"Render-Blocking JavaScript in Head",description:`Found ${s.length} synchronous scripts in <head> that block rendering.`,location:"<head>",suggestion:"Add async or defer attributes to script tags, or move scripts to the end of <body>.",codeSnippet:{before:'<script src="script.js"><\/script>',after:'<script src="script.js" defer><\/script>'},resources:["https://web.dev/efficiently-load-third-party-javascript/"]}),t}checkExcessiveScripts(){const t=[],i=this.document.querySelectorAll("script[src]");i.length>20&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.Medium,title:"Excessive Number of Scripts",description:`Page loads ${i.length} external scripts. This can impact performance.`,location:"document",suggestion:"Bundle and minify scripts, remove unused scripts, and use code splitting to load only what's needed.",resources:["https://web.dev/reduce-javascript-payloads-with-code-splitting/"]});const e=[],s=window.location.origin;return i.forEach(o=>{const a=o.getAttribute("src");a&&!a.startsWith("/")&&!a.startsWith(s)&&e.push(o)}),e.length>5&&t.push({id:crypto.randomUUID(),type:n.Performance,severity:r.Medium,title:"Multiple Third-Party Scripts",description:`Found ${e.length} third-party scripts that may slow down the page.`,location:"document",suggestion:"Review third-party scripts and remove unnecessary ones. Use async loading and consider facade patterns for heavy widgets.",resources:["https://web.dev/third-party-javascript/"]}),t}getMaxDOMDepth(t=this.document.documentElement,i=0){if(t.children.length===0)return i;let e=i;for(const s of Array.from(t.children)){const o=this.getMaxDOMDepth(s,i+1);e=Math.max(e,o)}return e}getElementPath(t){const i=[];let e=t;for(;e&&e!==this.document.documentElement;){let s=e.tagName.toLowerCase();if(e.id){s+=`#${e.id}`,i.unshift(s);break}else if(e.className){const o=Array.from(e.classList).slice(0,2).join(".");o&&(s+=`.${o}`)}i.unshift(s),e=e.parentElement}return i.join(" > ")}}class S{constructor(t){this.document=t,this.aiService=new b}async runTests(t){const i=[],e=[];await this.aiService.initialize();for(const h of t){const y=Date.now();let d=[];try{switch(h){case l.Links:d=this.testLinks();break;case l.Buttons:d=this.testButtons();break;case l.Forms:d=this.testForms();break;case l.Responsive:d=this.testResponsive();break;case l.SEO:d=new w(this.document).analyze();break;case l.Accessibility:d=new v(this.document).analyze();break;case l.Performance:d=new A(this.document).analyze();break;case l.Images:d=this.testImages();break;case l.Security:d=this.testSecurity();break}const p=Date.now()-y,g=this.getCheckCount(h),m=d.length,f=g-m;i.push({testType:h,passed:m===0,totalChecks:g,passedChecks:f,failedChecks:m,issues:d,duration:p,timestamp:new Date}),e.push(...d)}catch(p){console.error(`Error running ${h} test:`,p)}}console.log("ü§ñ Enhancing critical issues with AI...");const s={url:window.location.href,title:this.document.title||"Untitled Page"},o=await this.aiService.enhanceCriticalIssues(e,s),a=this.calculateHealthScore(o),u=this.generateSummary(o);return{url:window.location.href,timestamp:new Date,healthScore:a,testResults:i,allIssues:o,summary:u}}testLinks(){const t=[];return this.document.querySelectorAll("a").forEach(e=>{var o;const s=e.getAttribute("href");s?s==="#"||s==="javascript:void(0)"||s===""?t.push({id:crypto.randomUUID(),type:n.Functionality,severity:r.Medium,title:"Placeholder Link Detected",description:`Link has placeholder href: "${s}"`,location:this.getElementPath(e),element:e.outerHTML,suggestion:"Replace with actual destination URL or use a button if this is meant to be interactive.",codeSnippet:{before:`<a href="${s}">Click</a>`,after:'<a href="/actual-destination">Click</a>'}}):s.startsWith("/")&&s.length>1&&(s.includes("undefined")||s.includes("null"))&&t.push({id:crypto.randomUUID(),type:n.Functionality,severity:r.High,title:"Potentially Broken Link",description:`Link contains suspicious pattern: "${s}"`,location:this.getElementPath(e),element:e.outerHTML,suggestion:"Verify this link URL is correct and properly constructed."}):t.push({id:crypto.randomUUID(),type:n.Functionality,severity:r.Medium,title:"Link Missing href Attribute",description:"Anchor tag has no href attribute.",location:this.getElementPath(e),element:e.outerHTML,suggestion:"Add a valid href attribute or use a button element instead.",codeSnippet:{before:"<a>Click here</a>",after:'<a href="/destination">Click here</a>'}}),!((o=e.textContent)!=null&&o.trim())&&!e.querySelector("img")&&!e.hasAttribute("aria-label")&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.High,title:"Link Has No Text Content",description:"Link is empty and has no accessible name.",location:this.getElementPath(e),element:e.outerHTML,suggestion:"Add text content, an image with alt text, or an aria-label attribute."})}),t}testButtons(){const t=[];return this.document.querySelectorAll('button, [role="button"]').forEach(e=>{e.tagName==="BUTTON"&&!e.hasAttribute("type")&&t.push({id:crypto.randomUUID(),type:n.BestPractice,severity:r.Low,title:"Button Missing Type Attribute",description:'Button element lacks explicit type attribute (defaults to "submit").',location:this.getElementPath(e),element:e.outerHTML,suggestion:'Add type="button", type="submit", or type="reset" to be explicit.',codeSnippet:{before:"<button>Click</button>",after:'<button type="button">Click</button>'}}),e.tagName!=="BUTTON"&&!e.hasAttribute("tabindex")&&t.push({id:crypto.randomUUID(),type:n.Accessibility,severity:r.High,title:"Custom Button Not Keyboard Accessible",description:'Element with role="button" lacks tabindex for keyboard access.',location:this.getElementPath(e),element:e.outerHTML,suggestion:'Add tabindex="0" or use a native <button> element instead.',codeSnippet:{before:'<div role="button">Click</div>',after:'<div role="button" tabindex="0">Click</div>'}})}),t}testForms(){const t=[];return this.document.querySelectorAll("form").forEach(e=>{e.hasAttribute("action")||t.push({id:crypto.randomUUID(),type:n.BestPractice,severity:r.Low,title:"Form Missing Action Attribute",description:"Form has no action attribute specified.",location:this.getElementPath(e),element:e.outerHTML.substring(0,200),suggestion:"Add an action attribute or handle submission via JavaScript preventDefault."}),e.querySelectorAll('input[type="password"]').forEach(o=>{o.hasAttribute("autocomplete")||t.push({id:crypto.randomUUID(),type:n.Security,severity:r.Low,title:"Password Field Missing Autocomplete",description:"Password input lacks autocomplete attribute for better UX.",location:this.getElementPath(o),element:o.outerHTML,suggestion:'Add autocomplete="current-password" or "new-password" attribute.',codeSnippet:{before:'<input type="password" name="password">',after:'<input type="password" name="password" autocomplete="current-password">'}})})}),t}testResponsive(){const t=[],i=this.document.querySelectorAll("*");let e=0;return i.forEach(s=>{const a=window.getComputedStyle(s).width;a&&a.endsWith("px")&&parseInt(a)>1200&&e++}),e>5&&t.push({id:crypto.randomUUID(),type:n.BestPractice,severity:r.Medium,title:"Multiple Fixed-Width Elements",description:`Found ${e} elements with large fixed pixel widths that may not be responsive.`,location:"body",suggestion:"Use relative units (%, vw, rem) or max-width instead of fixed widths for better responsiveness."}),t}testImages(){const t=[];return this.document.querySelectorAll("img").forEach(e=>{e.complete&&e.naturalHeight===0&&t.push({id:crypto.randomUUID(),type:n.Functionality,severity:r.High,title:"Broken Image",description:`Image failed to load: ${e.src}`,location:this.getElementPath(e),element:e.outerHTML,suggestion:"Verify the image URL is correct and the file exists."})}),t}testSecurity(){const t=[];if(window.location.protocol==="https:"){const e=this.document.querySelectorAll("script[src]"),s=this.document.querySelectorAll("link[href]"),o=this.document.querySelectorAll("img[src]");[...e,...s,...o].forEach(a=>{const u=a.getAttribute("src")||a.getAttribute("href");u&&u.startsWith("http://")&&t.push({id:crypto.randomUUID(),type:n.Security,severity:r.High,title:"Mixed Content Detected",description:`Insecure HTTP resource on HTTPS page: ${u}`,location:this.getElementPath(a),element:a.outerHTML,suggestion:"Change to HTTPS URL or use protocol-relative URLs (//).",resources:["https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content"]})})}return this.document.querySelectorAll("form[action]").forEach(e=>{const s=e.getAttribute("action");s&&s.startsWith("http://")&&t.push({id:crypto.randomUUID(),type:n.Security,severity:r.Critical,title:"Insecure Form Submission",description:"Form submits data over insecure HTTP connection.",location:this.getElementPath(e),suggestion:"Change form action to HTTPS to protect user data.",resources:["https://web.dev/security-headers/"]})}),t}calculateHealthScore(t){const i={[r.Critical]:20,[r.High]:10,[r.Medium]:5,[r.Low]:2,[r.Info]:1};let e=0;t.forEach(a=>{e+=i[a.severity]});const s=Math.max(0,100-e),o=this.groupIssuesByType(t);return{overall:s,functionality:this.getTypeScore(o[n.Functionality]||[]),accessibility:this.getTypeScore(o[n.Accessibility]||[]),performance:this.getTypeScore(o[n.Performance]||[]),seo:this.getTypeScore(o[n.SEO]||[]),security:this.getTypeScore(o[n.Security]||[])}}getTypeScore(t){if(t.length===0)return 100;const i={[r.Critical]:25,[r.High]:15,[r.Medium]:8,[r.Low]:3,[r.Info]:1};let e=0;return t.forEach(s=>e+=i[s.severity]),Math.max(0,100-e)}groupIssuesByType(t){const i={};return t.forEach(e=>{i[e.type]||(i[e.type]=[]),i[e.type].push(e)}),i}generateSummary(t){return{totalIssues:t.length,criticalCount:t.filter(i=>i.severity===r.Critical).length,highCount:t.filter(i=>i.severity===r.High).length,mediumCount:t.filter(i=>i.severity===r.Medium).length,lowCount:t.filter(i=>i.severity===r.Low).length,infoCount:t.filter(i=>i.severity===r.Info).length}}getCheckCount(t){return{[l.Links]:this.document.querySelectorAll("a").length,[l.Buttons]:this.document.querySelectorAll('button, [role="button"]').length,[l.Forms]:this.document.querySelectorAll("form, input, textarea, select").length,[l.Responsive]:10,[l.SEO]:15,[l.Accessibility]:20,[l.Performance]:12,[l.Console]:1,[l.Images]:this.document.querySelectorAll("img").length,[l.Security]:10}[t]||10}getElementPath(t){const i=[];let e=t;for(;e&&e!==this.document.documentElement;){let s=e.tagName.toLowerCase();if(e.id){s+=`#${e.id}`,i.unshift(s);break}else if(e.className){const o=Array.from(e.classList).slice(0,2).join(".");o&&(s+=`.${o}`)}i.unshift(s),e=e.parentElement}return i.join(" > ")}}console.log("‚úÖ Visual QA Agent: Enhanced Content Script Loaded");console.log("üìç Page URL:",window.location.href);chrome.runtime.onMessage.addListener((c,t,i)=>c.type==="GET_DOM"?(i({dom:I()}),!0):c.type==="EXECUTE_ACTION"?(U(c.action),i({success:!0}),!0):c.type==="RUN_BUG_DETECTION"?(k(c.tests,i),!0):c.type==="CAPTURE_FULL_PAGE"?(E(i),!0):!1);async function E(c){console.log("üì∏ Starting full page screenshot capture...");try{const t=[],i=window.innerHeight*.9,e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),s=window.scrollY;console.log(`üìè Page dimensions: ${e}px tall, viewport: ${window.innerHeight}px`),console.log(`üî¢ Estimated screenshots needed: ${Math.ceil(e/i)}`),window.scrollTo(0,0),await new Promise(u=>setTimeout(u,300));let o=0,a=0;for(;o<e;){console.log(`üì∏ Capturing screenshot ${a+1} at position ${o}px`);const u=await chrome.runtime.sendMessage({type:"CAPTURE_VIEWPORT"});u.success&&u.screenshot&&(t.push(u.screenshot),a++),o+=i,o<e&&(window.scrollTo(0,o),await new Promise(h=>setTimeout(h,300)))}console.log(`‚úÖ Captured ${t.length} screenshots`),window.scrollTo(0,s),c({success:!0,screenshots:t,metadata:{totalHeight:e,viewportHeight:window.innerHeight,screenshotCount:t.length}})}catch(t){console.error("‚ùå Full page screenshot error:",t),c({success:!1,error:t.message})}}function I(){const c=Array.from(document.querySelectorAll("h1, h2, h3")).map(e=>{var s;return(s=e.textContent)==null?void 0:s.trim()}).filter(e=>e),t=Array.from(document.querySelectorAll("button, a")).map(e=>{var s;return{text:(s=e.textContent)==null?void 0:s.trim(),href:e.href}}).slice(0,10),i=Array.from(document.querySelectorAll("form"));return JSON.stringify({title:document.title,url:window.location.href,headings:c.slice(0,5),buttons:t,formCount:i.length},null,2)}function U(c){switch(console.log("Executing action:",c),c.type){case"CLICK":const t=document.querySelector(c.selector);t?(t.click(),console.log(`Clicked: ${c.selector}`)):console.warn(`Element not found: ${c.selector}`);break;case"TYPE":const i=document.querySelector(c.selector);i?(i.value=c.text,i.dispatchEvent(new Event("input",{bubbles:!0})),console.log(`Typed into: ${c.selector}`)):console.warn(`Element not found: ${c.selector}`);break;case"SCROLL":c.direction==="down"?window.scrollBy(0,window.innerHeight*.8):c.direction==="up"&&window.scrollBy(0,-window.innerHeight*.8),console.log(`Scrolled: ${c.direction}`);break}}async function k(c,t){try{console.log("üîç Starting bug detection tests:",c),console.log("üìä Number of tests:",c.length),console.log("üöÄ Initializing BugDetectionService...");const i=new S(document);chrome.runtime.sendMessage({type:"TEST_PROGRESS",progress:0,message:"Initializing tests..."}),console.log("‚öôÔ∏è Running tests...");const e=await i.runTests(c);console.log("‚úÖ Bug detection complete!"),console.log("üìä Report summary:",{totalIssues:e.summary.totalIssues,healthScore:e.healthScore.overall,criticalCount:e.summary.criticalCount}),t({success:!0,report:e})}catch(i){console.error("‚ùå Bug detection error:",i),t({success:!1,error:i.message||String(i)})}}
